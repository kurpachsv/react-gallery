"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var PropTypes=_interopDefault(require("prop-types")),React=require("react"),React__default=_interopDefault(React),isEqual=_interopDefault(require("lodash.isequal"));function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}var css=".image_image__3LZ6Y {\n    cursor: pointer;\n    position: absolute;\n    width: 100%;\n    max-width: 100%;\n    height: auto;\n}\n",style={image:"image_image__3LZ6Y"};styleInject(css);var Image=function(e){var t=e.src,n=e.alt;return React__default.createElement("img",{className:style.image,src:t,alt:n})};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){_defineProperty(t,e,n[e])})}return t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}Image.propTypes={src:PropTypes.string.isRequired,alt:PropTypes.string},Image.defaultProps={alt:""};var Engine=function(){function o(e){var t=e.containerWidth,n=e.gutterInPercent,r=e.minHeight,i=e.maxHeight;_classCallCheck(this,o),this.containerWidth=t,this.gutterInPercent=n,this.minHeight=r,this.maxHeight=i}return _createClass(o,[{key:"setContainerWidth",value:function(e){this.containerWidth=e}},{key:"setGutterInPercent",value:function(e){this.gutterInPercent=e}},{key:"setMinHeight",value:function(e){this.minHeight=e}},{key:"setMaxHeight",value:function(e){this.maxHeight=e}},{key:"_normalizeByHeight",value:function(e){var t=this,n=[];return e.forEach(function(e){n.push(o._resizeByHeight(e,t.minHeight))}),n}},{key:"_buildRow",value:function(e){for(var t=[],n=0;0<e.length&&n<this.containerWidth;){var r=e.shift();t.push(r),n+=r.width}return{row:t,isIncomplete:n<this.containerWidth}}},{key:"getNormalizedItems",value:function(e){return e=e.map(function(e){return _objectSpread({},e,{height:e.height,width:e.width,src:e.src})}),this._normalizeByHeight(e)}},{key:"calculateHeight",value:function(e,t,n,r){var i=e/o._getRowWidth(n),a=o._getRowMinHeight(n)*i*(100-(n.length-1)*this.gutterInPercent)/100;return r&&a>this.maxHeight?this.maxHeight:a}},{key:"calculateWidth",value:function(e,t,n,r){return o._resizeByHeight(t,this.calculateHeight(e,t,n,r)).width}},{key:"buildRows",value:function(e){for(var t=[],n=this.getNormalizedItems(e);0<n.length;){var r=this._buildRow(n);t.push(r)}return t}}],[{key:"_getRowMinHeight",value:function(e){return Math.min.apply(null,e.map(function(e){return e.height}))}},{key:"_getRowWidth",value:function(e){return e.map(function(e){return e.width}).reduce(function(e,t){return e+t},0)}},{key:"_resizeByHeight",value:function(e,t){return _objectSpread({},e,{width:e.width/e.height*t,height:t})}}]),o}(),css$1=".gallery_container__WHVf3 {\n    display: block;\n    font-size: 0;\n}\n\n.gallery_row__16kGn {\n    display: block;\n}\n\n.gallery_column__3ltJa {\n    position: relative;\n    display: inline-block;\n}\n",style$1={container:"gallery_container__WHVf3",row:"gallery_row__16kGn",column:"gallery_column__3ltJa"};styleInject(css$1);var CONTAINER_WIDTH=1e3,MAX_HEIGHT=250,MIN_HEIGHT=200,GUTTER_IN_PERCENT=.5,Gallery=function(e){function n(e){var t;return _classCallCheck(this,n),_defineProperty(_assertThisInitialized(_assertThisInitialized(t=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,e)))),"state",{rows:[]}),t.engine=new Engine({containerWidth:e.containerWidth,gutterInPercent:e.gutterInPercent,minHeight:e.minHeight,maxHeight:e.maxHeight}),t}return _inherits(n,React.Component),_createClass(n,[{key:"componentWillMount",value:function(){var e=this.props,t=e.images,n=e.containerWidth,r=e.gutterInPercent,i=e.className,a=e.columnClassName,o=e.rowClassName;this.setState({rows:this.engine.buildRows(t),containerWidth:n,gutterInPercent:r,className:i,columnClassName:a,rowClassName:o})}},{key:"componentWillReceiveProps",value:function(e){isEqual(this.props,e)||(this.engine.setContainerWidth(e.containerWidth),this.engine.setGutterInPercent(e.gutterInPercent),this.engine.setMinHeight(e.minHeight),this.engine.setMaxHeight(e.maxHeight),this.setState({containerWidth:e.containerWidth,gutterInPercent:e.gutterInPercent,className:e.className,columnClassName:e.columnClassName,rowClassName:e.rowClassName,rows:this.engine.buildRows(e.images)}))}},{key:"render",value:function(){var l=this,u=this.props.imageRenderer,e=this.state,t=e.rows,h=e.containerWidth,p=e.gutterInPercent,n=e.className,r=e.rowClassName,g=e.columnClassName;return React__default.createElement("div",{className:"".concat(style$1.container," ").concat(n)},t.map(function(o,s){var c=o.row;return React__default.createElement("div",{key:s,className:"".concat(style$1.row," ").concat(r)},c.map(function(e,t){var n=l.engine.calculateWidth(h,e,c,o.isIncomplete),r=l.engine.calculateHeight(h,e,c,o.isIncomplete),i=100*n/h,a=100*r/n;return React__default.createElement("div",{key:"column-".concat(e.src,"-").concat(s,"-").concat(t),className:"".concat(style$1.column," ").concat(g),style:{width:o.isIncomplete?"".concat(n,"px"):"".concat(i,"%"),maxWidth:o.isIncomplete?"".concat(i,"%"):"auto",margin:c.length===t+1?"0 0 ".concat(p,"% 0"):"0 ".concat(p,"% ").concat(p,"% 0")}},u(_objectSpread({},e,{newWidth:n,newHeight:r,newWidthInPercent:i,placeholderHeight:a})))}))}))}}]),n}();_defineProperty(Gallery,"propTypes",{imageRenderer:PropTypes.func.isRequired,images:PropTypes.array.isRequired,containerWidth:PropTypes.number,maxHeight:PropTypes.number,minHeight:PropTypes.number,gutterInPercent:PropTypes.number,className:PropTypes.string,columnClassName:PropTypes.string,rowClassName:PropTypes.string}),_defineProperty(Gallery,"defaultProps",{containerWidth:CONTAINER_WIDTH,maxHeight:MAX_HEIGHT,minHeight:MIN_HEIGHT,gutterInPercent:GUTTER_IN_PERCENT,className:"",columnClassName:"",rowClassName:""}),exports.Image=Image,exports.Gallery=Gallery;
